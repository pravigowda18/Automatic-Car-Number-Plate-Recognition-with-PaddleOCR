<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>License Plate Recognition</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Remix Icon -->
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f1f5f9;
      }

      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #e2e8f0;
      }

      ::-webkit-scrollbar-thumb {
        background: #94a3b8;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }

      .live-indicator {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
      }

      .video-container {
        position: relative;
        background: #0f172a;
        overflow: hidden;
        border-radius: 0.75rem;
      }

      .video-container video,
      .video-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .video-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #94a3b8;
      }

      .video-placeholder i {
        font-size: 5rem;
        line-height: 1;
        opacity: 0.5;
      }

      #ownerDetails {
        transition: opacity 0.5s ease-in-out;
      }
    </style>
  </head>

  <body class="text-gray-800">
    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-40">
      <nav
        class="container mx-auto px-6 py-4 flex justify-between items-center"
      >
        <a href="#" class="text-2xl font-bold text-sky-600">LP-Detect</a>
        <div class="hidden md:flex items-center space-x-8">
          <a
            href="#"
            class="text-sky-600 font-semibold border-b-2 border-sky-600 pb-1"
            >Recognition</a
          >
          <a href="#" class="text-gray-600 hover:text-sky-600">History</a>
          <a href="#" class="text-gray-600 hover:text-sky-600">About</a>
          <a href="#" class="text-gray-600 hover:text-sky-600">Contact</a>
        </div>
        <div class="flex items-center">
          <button
            id="profile-button"
            class="w-10 h-10 rounded-full bg-sky-500 text-white flex items-center justify-center text-xl font-bold hover:bg-sky-700"
          >
            <i class="ri-user-line"></i>
          </button>
        </div>
      </nav>
    </header>

    <aside
      id="profile-sidebar"
      class="fixed top-0 right-0 h-full w-72 bg-white shadow-xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out"
    >
      <div class="p-6">
        <div class="flex justify-between items-center mb-8">
          <h3 class="text-xl font-semibold">User Profile</h3>
          <button
            id="close-sidebar-button"
            class="text-gray-500 hover:text-red-500"
          >
            <i class="ri-close-line text-2xl"></i>
          </button>
        </div>
        <div class="flex flex-col items-center text-center">
          <img
            src="https://placehold.co/100x100/06b6d4/ffffff?text=User"
            alt="User"
            class="w-24 h-24 rounded-full border-4 border-cyan-200 mb-4"
          />
          <h4 class="text-lg font-semibold">Praveen Kumar</h4>
          <p class="text-sm text-gray-500">praveen@example.com</p>
          <button
            class="mt-8 w-full bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 flex items-center justify-center space-x-2"
          >
            <i class="ri-logout-box-r-line"></i>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </aside>
    <div
      id="sidebar-overlay"
      class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"
    ></div>

    <!-- Main -->
    <main class="container mx-auto px-6 py-12">
      <div class="text-center mb-12">
        <div class="flex items-center justify-center mb-4">
          <div
            class="w-16 h-16 bg-sky-500 text-white rounded-2xl flex items-center justify-center shadow-lg relative"
          >
            <i class="ri-roadster-line text-4xl"></i>
            <div
              id="live-dot"
              class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full border-2 border-white flex items-center justify-center live-indicator hidden"
            >
              <div class="w-2 h-2 bg-white rounded-full"></div>
            </div>
          </div>
        </div>
        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900">
          License Plate Recognition
        </h1>
        <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">
          Real-time vehicle license plate detection and owner details lookup.
        </p>
      </div>

      <!-- Video Section -->
      <div
        class="flex flex-col items-center max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-2xl shadow-lg"
      >
        <div
          id="video-container"
          class="relative w-[640px] h-[480px] border-solid border-4 bg-gray-800 rounded-xl"
        >
          <div
            id="video-placeholder"
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-center"
          >
            <i class="ri-video-off-line text-9xl opacity-20"></i>
            <p class="mt-4 text-2xl opacity-20">Webcam is off</p>
          </div>
        </div>

        <div
          class="mt-6 flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4"
        >
          <button
            id="start-btn"
            class="w-full sm:w-48 py-3 px-6 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 flex items-center justify-center"
          >
            <i class="ri-play-fill mr-2 text-xl"></i>Start Camera
          </button>
          <button
            id="stop-btn"
            disabled
            class="w-full sm:w-48 py-3 px-6 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 flex items-center justify-center"
          >
            <i class="ri-stop-fill mr-2 text-xl"></i>Stop Camera
          </button>
          <button
            id="check-details-btn"
            class="w-full sm:w-48 py-3 px-6 bg-sky-500 text-white font-semibold rounded-lg hover:bg-sky-600 flex items-center justify-center"
          >
            <i class="ri-search-2-line mr-2 text-xl"></i>Check Details
          </button>
        </div>
      </div>

      <!-- Owner Details -->
      <div id="ownerDetailsContainer" class="max-w-4xl mx-auto mt-12">
        <div
          id="ownerDetails"
          class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg opacity-0 hidden"
        >
          <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <i class="ri-user-search-line mr-3 text-sky-500"></i>Recognized
            Plate Details
          </h2>
          <div
            class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-5 text-base"
          >
            <div class="flex items-center bg-slate-50 p-3 rounded-lg">
              <div>
                <p class="text-sm font-semibold text-slate-500">
                  License Plate
                </p>
                <p id="detail-plate" class="font-bold text-lg text-slate-800">
                  --
                </p>
              </div>
            </div>
            <div class="flex items-center bg-slate-50 p-3 rounded-lg">
              <div>
                <p class="text-sm font-semibold text-slate-500">Owner's Name</p>
                <p id="detail-name" class="font-medium text-slate-800">--</p>
              </div>
            </div>
            <div class="flex items-center bg-slate-50 p-3 rounded-lg">
              <div>
                <p class="text-sm font-semibold text-slate-500">Car Model</p>
                <p id="detail-model" class="font-medium text-slate-800">--</p>
              </div>
            </div>
            
            <div class="flex items-start bg-slate-50 p-3 rounded-lg">
              <div>
                <p class="text-sm font-semibold text-slate-500">Address</p>
                <p id="detail-address" class="font-medium text-slate-800">--</p>
              </div>
            </div>
            <div class="flex items-start bg-slate-50 p-3 rounded-lg">
              <div>
                <p class="text-sm font-semibold text-slate-500">Make</p>
                <p id="detail-make" class="font-medium text-slate-800">--</p>
              </div>
            </div>
            <div class="flex items-start bg-slate-50 p-3 rounded-lg">
              <div>
                <p class="text-sm font-semibold text-slate-500">Year</p>
                <p id="detail-year" class="font-medium text-slate-800">--</p>
              </div>
            </div>
            <div class="flex items-start bg-slate-50 p-3 rounded-lg">
              <div>
                <p class="text-sm font-semibold text-slate-500">Color</p>
                <p id="detail-color" class="font-medium text-slate-800">--</p>
              </div>
            </div>
            <div
              class="md:col-span-2 flex items-start bg-slate-50 p-3 rounded-lg"
            >
              <div>
                <p class="text-sm font-semibold text-slate-500">REgistration Date</p>
                <p id="detail-regdate" class="font-medium text-slate-800">--</p>
              </div>
            </div>
            <div class="flex items-center bg-slate-50 p-3 rounded-lg">
              <div>
                <p class="text-sm font-semibold text-slate-500">Expiration Date</p>
                <p id="detail-expdate" class="font-medium text-slate-800">--</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const profileButton = document.getElementById("profile-button");
        const sidebar = document.getElementById("profile-sidebar");
        const closeButton = document.getElementById("close-sidebar-button");
        const overlay = document.getElementById("sidebar-overlay");

        const container = document.getElementById("video-container");
        const startBtn = document.getElementById("start-btn");
        const stopBtn = document.getElementById("stop-btn");
        const checkDetailsBtn = document.getElementById("check-details-btn");
        const videoPlaceholder = document.getElementById("video-placeholder");
        const liveDot = document.getElementById("live-dot");
        const ownerDetails = document.getElementById("ownerDetails");

        profileButton.addEventListener("click", () => {
          sidebar.classList.remove("translate-x-full");
          overlay.classList.remove("hidden");
          document.body.style.overflow = "hidden";
        });

        closeButton.addEventListener("click", () => {
          sidebar.classList.add("translate-x-full");
          overlay.classList.add("hidden");
          document.body.style.overflow = "";
        });

        overlay.addEventListener("click", () => {
          sidebar.classList.add("translate-x-full");
          overlay.classList.add("hidden");
          document.body.style.overflow = "";
        });

        startBtn.addEventListener("click", function () {
          stopBtn.disabled = false;
          liveDot.classList.remove("hidden");
          startBtn.disabled = true;
          const existing = document.getElementById('video-feed');
                if (existing) {
                    existing.remove();  // Remove previous stream if any
                }
          fetch("/start_stream", { method: "POST" }).then(() => {
            if (!document.getElementById("video-feed")) {
              videoPlaceholder.classList.add("hidden");
              const img = document.createElement("img");
              img.src = "/video_feed";
              img.id = "video-feed";
              img.width = 640;
              img.height = 480;
              container.innerHTML = "";
              container.appendChild(img);
            }
          });
        });

        stopBtn.addEventListener("click", function () {
          fetch("/stop_stream", { method: "POST" }).then(() => {
            const video = document.getElementById("video-feed");
            if (video) video.remove();
            startBtn.disabled = false;
            stopBtn.disabled = true;
            videoPlaceholder.classList.remove("hidden");
            liveDot.classList.add("hidden");
            
          });
        });

        checkDetailsBtn.addEventListener("click", function () {
          fetch("/get_owner_details")
            .then((response) => response.json())
            .then((data) => {
              if (data && data.license_number) {
                document.getElementById("detail-plate").innerText =
                  data.license_number;
                document.getElementById("detail-name").innerText = data.owner;
                document.getElementById("detail-model").innerText = data.model;
                document.getElementById("detail-expdate").innerText = data.expiration_date; 
                document.getElementById("detail-regdate").innerText = data.registration_date; 
                document.getElementById("detail-color").innerText = data.color; 
                document.getElementById("detail-year").innerText = data.year; 
                document.getElementById("detail-make").innerText = data.make; 
                document.getElementById("detail-address").innerText =
                  data.address;
                ownerDetails.classList.remove("hidden");
                ownerDetails.classList.add("opacity-100");
              } else {
                alert("No matching vehicle found!");
              }
            })
            .catch((error) => {
              console.error("Error fetching owner details:", error);
            });
        });

        document.addEventListener("keydown", function (event) {
          if (
            event.key === "Escape" &&
            !sidebar.classList.contains("translate-x-full")
          ) {
            sidebar.classList.add("translate-x-full");
            overlay.classList.add("hidden");
            document.body.style.overflow = "";
          }
        });
      });
    </script>
  </body>
</html>
